{
  "test_type": "Replay Attack and Race Condition Security",
  "timestamp": "2025-09-01 20:27:16",
  "summary": {
    "total_tests": 25,
    "passed": 12,
    "failed": 0,
    "errors": 0,
    "success_rate": "48.0%"
  },
  "results": [
    {
      "test": "Immediate cookie replay #1",
      "cookie": "auth_cookie_123456789",
      "original_timestamp": 1756758436243,
      "replay_timestamp": 1756758436243,
      "time_diff_ms": 0,
      "status": "TESTED"
    },
    {
      "test": "Delayed cookie replay #1",
      "cookie": "auth_cookie_123456789",
      "original_timestamp": 1756758436243,
      "replay_timestamp": 1756758436343,
      "time_diff_ms": 100,
      "hmac_matches": true,
      "status": "SHOULD_FAIL_HMAC",
      "expected_result": "HMAC verification should fail"
    },
    {
      "test": "Old timestamp cookie replay #1",
      "cookie": "auth_cookie_123456789",
      "timestamp": 1756758376343,
      "age_seconds": 60,
      "status": "SHOULD_FAIL_TIMESTAMP",
      "expected_result": "Should fail due to old timestamp"
    },
    {
      "test": "Immediate cookie replay #2",
      "cookie": "session_abc123def456",
      "original_timestamp": 1756758436343,
      "replay_timestamp": 1756758436343,
      "time_diff_ms": 0,
      "status": "TESTED"
    },
    {
      "test": "Delayed cookie replay #2",
      "cookie": "session_abc123def456",
      "original_timestamp": 1756758436343,
      "replay_timestamp": 1756758436443,
      "time_diff_ms": 100,
      "hmac_matches": true,
      "status": "SHOULD_FAIL_HMAC",
      "expected_result": "HMAC verification should fail"
    },
    {
      "test": "Old timestamp cookie replay #2",
      "cookie": "session_abc123def456",
      "timestamp": 1756758376443,
      "age_seconds": 60,
      "status": "SHOULD_FAIL_TIMESTAMP",
      "expected_result": "Should fail due to old timestamp"
    },
    {
      "test": "Immediate cookie replay #3",
      "cookie": "polkit_auth_token_xyz789",
      "original_timestamp": 1756758436443,
      "replay_timestamp": 1756758436443,
      "time_diff_ms": 0,
      "status": "TESTED"
    },
    {
      "test": "Delayed cookie replay #3",
      "cookie": "polkit_auth_token_xyz789",
      "original_timestamp": 1756758436443,
      "replay_timestamp": 1756758436544,
      "time_diff_ms": 101,
      "hmac_matches": true,
      "status": "SHOULD_FAIL_HMAC",
      "expected_result": "HMAC verification should fail"
    },
    {
      "test": "Old timestamp cookie replay #3",
      "cookie": "polkit_auth_token_xyz789",
      "timestamp": 1756758376544,
      "age_seconds": 60,
      "status": "SHOULD_FAIL_TIMESTAMP",
      "expected_result": "Should fail due to old timestamp"
    },
    {
      "test": "Session expiry - Valid session",
      "session_start_time": 1756758376544,
      "current_time": 1756758436544,
      "session_age_ms": 60000,
      "session_age_minutes": 1,
      "timeout_ms": 300000,
      "is_expired": false,
      "should_expire": false,
      "status": "PASS"
    },
    {
      "test": "Session expiry - Expired session",
      "session_start_time": 1756757836544,
      "current_time": 1756758436544,
      "session_age_ms": 600000,
      "session_age_minutes": 10,
      "timeout_ms": 300000,
      "is_expired": true,
      "should_expire": true,
      "status": "PASS"
    },
    {
      "test": "Session expiry - Just expired session",
      "session_start_time": 1756758130544,
      "current_time": 1756758436544,
      "session_age_ms": 306000,
      "session_age_minutes": 5.1,
      "timeout_ms": 300000,
      "is_expired": true,
      "should_expire": true,
      "status": "PASS"
    },
    {
      "test": "Session expiry - Edge case session",
      "session_start_time": 1756758136544,
      "current_time": 1756758436544,
      "session_age_ms": 300000,
      "session_age_minutes": 5.0,
      "timeout_ms": 300000,
      "is_expired": false,
      "should_expire": false,
      "status": "PASS"
    },
    {
      "test": "Concurrent authentication race condition",
      "num_threads": 5,
      "total_time_seconds": 0.0496063232421875,
      "completed_authentications": 5,
      "error_authentications": 0,
      "same_cookie_used": "race_condition_test_cookie",
      "worker_results": [
        {
          "worker_id": 3,
          "cookie": "race_condition_test_cookie",
          "timestamp": 1756758436544,
          "processing_time": 0.012153709141326723,
          "status": "COMPLETED"
        },
        {
          "worker_id": 1,
          "cookie": "race_condition_test_cookie",
          "timestamp": 1756758436544,
          "processing_time": 0.017112385456107895,
          "status": "COMPLETED"
        },
        {
          "worker_id": 4,
          "cookie": "race_condition_test_cookie",
          "timestamp": 1756758436545,
          "processing_time": 0.025721102619335676,
          "status": "COMPLETED"
        },
        {
          "worker_id": 2,
          "cookie": "race_condition_test_cookie",
          "timestamp": 1756758436544,
          "processing_time": 0.02817167301807065,
          "status": "COMPLETED"
        },
        {
          "worker_id": 0,
          "cookie": "race_condition_test_cookie",
          "timestamp": 1756758436544,
          "processing_time": 0.04663378846630926,
          "status": "COMPLETED"
        }
      ],
      "status": "COMPLETED",
      "potential_issue": "Multiple authentications completed for same cookie",
      "security_concern": "Race condition may allow multiple successful authentications"
    },
    {
      "test": "Timestamp manipulation - Future timestamp",
      "test_timestamp": 1756758496593,
      "current_timestamp": 1756758436593,
      "time_diff_ms": 60000,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Far future timestamp",
      "test_timestamp": 1756762036593,
      "current_timestamp": 1756758436593,
      "time_diff_ms": 3600000,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Slightly future timestamp",
      "test_timestamp": 1756758437593,
      "current_timestamp": 1756758436593,
      "time_diff_ms": 1000,
      "max_allowed_skew_ms": 30000,
      "should_reject": false,
      "expected_to_fail": false,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Past timestamp",
      "test_timestamp": 1756758376593,
      "current_timestamp": 1756758436593,
      "time_diff_ms": -60000,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Far past timestamp",
      "test_timestamp": 1756754836593,
      "current_timestamp": 1756758436593,
      "time_diff_ms": -3600000,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Zero timestamp",
      "test_timestamp": 0,
      "current_timestamp": 1756758436593,
      "time_diff_ms": -1756758436593,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Negative timestamp",
      "test_timestamp": -1000,
      "current_timestamp": 1756758436593,
      "time_diff_ms": -1756758437593,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Timestamp manipulation - Maximum timestamp",
      "test_timestamp": 9223372036854775807,
      "current_timestamp": 1756758436593,
      "time_diff_ms": 9223370280096339214,
      "max_allowed_skew_ms": 30000,
      "should_reject": true,
      "expected_to_fail": true,
      "status": "PASS"
    },
    {
      "test": "Exact HMAC replay",
      "original_hmac": "beb8ddf88b76d23c53207dec374ad745f240e3a886786b6638eca95f263cacfb",
      "replay_hmac": "beb8ddf88b76d23c53207dec374ad745f240e3a886786b6638eca95f263cacfb",
      "hmac_matches": true,
      "timestamp_matches": true,
      "status": "POTENTIAL_REPLAY",
      "security_note": "Exact replay should be blocked by nonce or other mechanism"
    },
    {
      "test": "Modified message with original HMAC",
      "original_hmac": "beb8ddf88b76d23c53207dec374ad745f240e3a886786b6638eca95f263cacfb",
      "message_hmac": "beb8ddf88b76d23c53207dec374ad745f240e3a886786b6638eca95f263cacfb",
      "expected_hmac": "e1e59a7e98205655fc8a3e347e259f8d2881ab5fb4651f695f12e8b67cc45bb1",
      "hmac_verification_should_fail": true,
      "status": "SHOULD_FAIL_HMAC",
      "security_check": "HMAC verification must fail for modified messages"
    },
    {
      "test": "Message with wrong HMAC key",
      "correct_hmac": "e1e59a7e98205655fc8a3e347e259f8d2881ab5fb4651f695f12e8b67cc45bb1",
      "wrong_key_hmac": "33b172dd5d9a037589a67779b231cc3e3a9f5bb7f8dc9c8e0c428bbd47f800f9",
      "hmacs_different": true,
      "status": "SHOULD_FAIL_HMAC",
      "security_check": "HMAC with wrong key must fail verification"
    }
  ]
}